Could be improved by exploiting the symetries on z dimension for Part 1 and z/w dimensions for Part 2
